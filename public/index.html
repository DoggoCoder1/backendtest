<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>wowchat</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
  <link rel=stylesheet href="/styles.css">
</head>
<body>
  <div id="authSection">
    <h2>Register</h2>
    <input id="registerUsername" placeholder="Username" type="text">
    <input id="registerPassword" placeholder="Password" type="password">
    <button onclick="registerUser()">Register</button>
    <p id="registerMessage"></p>

    <h2>Login</h2>
    <input id="loginUsername" placeholder="Username" type="text">
    <input id="loginPassword" placeholder="Password" type="password">
    <button onclick="loginUser()">Login</button>
    <p id="loginMessage"></p>
  </div>

  <div id="clickerSection" style="display:none;">
  <p>Logged in as: <strong id="loggedInUsername"></strong></p>
  <h3>Your Clicks: <span id="userClickCount">0</span></h3>
  <button onclick="sendClick()">Click Me!</button>
  <button onclick="logout()">Logout</button>

  <h3>üèÜ Top 3 Leaderboard</h3>
  <ol id="leaderboardList"></ol>
  </div>


<script>
  const userClickCountEl = document.getElementById('userClickCount');
const leaderboardList = document.getElementById('leaderboardList');
const clickerSection = document.getElementById('clickerSection');

// Replace fetchMessages() with:
async function fetchLeaderboard() {
  try {
    const res = await fetch('/api/leaderboard');
    const data = await res.json();
    leaderboardList.innerHTML = '';

    data.leaderboard.forEach(user => {
      const li = document.createElement('li');
      li.textContent = `${user.username} - ${user.click_count} clicks`;
      leaderboardList.appendChild(li);
    });
  } catch (err) {
    console.error('Error fetching leaderboard:', err);
  }
}

// New: sendClick()
async function sendClick() {
  if (!token) return;

  try {
    const res = await fetch('/api/click', {
      method: 'POST',
      headers: { 'Authorization': `Bearer ${token}` }
    });

    if (res.ok) {
      const data = await res.json();
      userClickCountEl.textContent = data.clickCount;
      fetchLeaderboard(); // Refresh leaderboard after each click
    } else {
      console.error('Click failed');
    }
  } catch (err) {
    console.error('Click error:', err);
  }
}

// Update updateUI() to show the clicker section instead
function updateUI() {
  if (token && currentUsername) {
    authSection.style.display = 'none';
    clickerSection.style.display = 'block';
    loggedInUsernameDisplay.textContent = currentUsername;
    fetchLeaderboard(); // Load leaderboard on login
    sendClick(); // Get initial user click count (optional)
  } else {
    authSection.style.display = 'block';
    clickerSection.style.display = 'none';
    leaderboardList.innerHTML = '';
    userClickCountEl.textContent = '0';
  }
}

</script>
</body>
</html>
